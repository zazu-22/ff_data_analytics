version: 2

models:
  - name: mart_real_world_actuals_weekly
    description: |
      Real-world actuals mart - weekly player performance in physical stats (no fantasy scoring).

      **Grain**: One row per player per season per week
      **Source**: fact_player_stats (pivoted from long to wide form)

      Part of 2Ã—2 model:
      - This mart: Real-world actuals (yards, TDs, receptions, etc.)
      - Partner mart: mart_fantasy_actuals_weekly (applies scoring rules)

      Provides denormalized player/team attributes via dimension joins.

    columns:
      - name: player_id
        description: Canonical player identifier (FK to dim_player)
        data_tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_player')
                field: player_id
              config:
                where: "player_id != -1"  # Allow unmapped players

      - name: player_key
        description: Composite player identifier for grain uniqueness
        data_tests:
          - not_null

      - name: season
        description: NFL season year
        data_tests:
          - not_null

      - name: week
        description: Week number (1-22, includes playoffs)
        data_tests:
          - not_null

      - name: season_type
        description: Season type (REG, POST, WC, DIV, CON, SB, PRE)
        data_tests:
          - not_null
          - accepted_values:
              arguments:
                values: ['REG', 'POST', 'WC', 'DIV', 'CON', 'SB', 'PRE']

      - name: position
        description: Player position
        data_tests:
          - not_null

      - name: display_name
        description: Player display name from dim_player
        data_tests:
          - not_null:
              config:
                where: "player_id != -1"  # Unmapped players may lack display_name

      - name: games_played
        description: Games played (always 1 for weekly grain)
        data_tests:
          - not_null
          - accepted_values:
              arguments:
                values: [1]

      - name: completions
        description: "Passing completions"

      - name: attempts
        description: "Passing attempts"

      - name: passing_yards
        description: "Passing yards"

      - name: passing_tds
        description: "Passing touchdowns"

      - name: passing_interceptions
        description: "Interceptions thrown"

      - name: passing_2pt_conversions
        description: "Two-point conversion passes"

      - name: carries
        description: "Rushing attempts"

      - name: rushing_yards
        description: "Rushing yards"

      - name: rushing_tds
        description: "Rushing touchdowns"

      - name: rushing_fumbles_lost
        description: "Rushing fumbles lost"

      - name: rushing_2pt_conversions
        description: "Two-point conversion rushes"

      - name: targets
        description: "Receiving targets"

      - name: receptions
        description: "Receptions"

      - name: receiving_yards
        description: "Receiving yards"

      - name: receiving_tds
        description: "Receiving touchdowns"

      - name: receiving_fumbles_lost
        description: "Receiving fumbles lost"

      - name: receiving_2pt_conversions
        description: "Two-point conversion receptions"

      - name: def_tackles_solo
        description: "Solo tackles (IDP)"

      - name: def_tackles_with_assist
        description: "Assisted tackles (IDP)"

      - name: def_sacks
        description: "Sacks (IDP)"

      - name: def_interceptions
        description: "Interceptions (IDP)"

      - name: def_fumbles_forced
        description: "Fumbles forced (IDP)"

      - name: def_tds
        description: "Defensive touchdowns (IDP)"

      - name: def_safeties
        description: "Safeties (IDP)"

      - name: sacks_suffered
        description: "Times sacked (negative stat)"

      - name: special_teams_tds
        description: "Special teams touchdowns"

      - name: current_team
        description: "Current NFL team from dim_player"

    data_tests:
      - dbt_utils.unique_combination_of_columns:
          arguments:
            combination_of_columns:
              - player_key
              - season
              - week
              - season_type
          config:
            severity: error
            error_if: ">0"
