version: 2

models:
  - name: stg_ffanalytics__projections
    description: "Staged FFanalytics consensus projections with player ID mapping"
    columns:
      - name: player_id
        description: "Canonical player ID (sequential surrogate 1-N) mapped by R runner"
        data_tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_player_id_xref')
                field: player_id
      - name: season
        description: "NFL season year"
        data_tests:
          - not_null
          - accepted_values:
              arguments:
                values: [2020, 2021, 2022, 2023, 2024, 2025]
      - name: horizon
        description: "Projection timeframe"
        data_tests:
          - not_null
          - accepted_values:
              arguments:
                values: ["weekly", "full_season", "rest_of_season", "unknown"]
      - name: asof_date
        description: "When projection was made (UTC)"
        data_tests:
          - not_null
      - name: provider
        description: "Projection provider"
        data_tests:
          - not_null
          - accepted_values:
              arguments:
                values: ["ffanalytics_consensus"]
      - name: current_team
        description: "Canonical team code from dim_player_id_xref (fallback to consensus label if unavailable)"
      - name: team_consensus
        description: "Weighted consensus team label prior to crosswalk normalization (for QA)"

      - name: player_name
        description: "Player name from FFanalytics provider"

      - name: position
        description: "Player position from FFanalytics provider"

      - name: week
        description: "NFL week number (null for season-long projections)"

      - name: source_count
        description: "Number of projection sources contributing to consensus"

      - name: total_weight
        description: "Sum of weights across all contributing sources"

      - name: completions
        description: "Projected passing completions"

      - name: attempts
        description: "Projected passing attempts"

      - name: passing_yards
        description: "Projected passing yards"

      - name: passing_tds
        description: "Projected passing touchdowns"

      - name: interceptions
        description: "Projected interceptions thrown"

      - name: rushing_attempts
        description: "Projected rushing attempts"

      - name: rushing_yards
        description: "Projected rushing yards"

      - name: rushing_tds
        description: "Projected rushing touchdowns"

      - name: targets
        description: "Projected receiving targets (not available in FFanalytics)"

      - name: receptions
        description: "Projected receptions"

      - name: receiving_yards
        description: "Projected receiving yards"

      - name: receiving_tds
        description: "Projected receiving touchdowns"

      - name: fumbles_lost
        description: "Projected fumbles lost"

      - name: idp_solo_tackles
        description: "Projected solo tackles (IDP)"

      - name: idp_assisted_tackles
        description: "Projected assisted tackles (IDP)"

      - name: idp_sacks
        description: "Projected sacks (IDP)"

      - name: idp_passes_defended
        description: "Projected passes defended (IDP)"

      - name: idp_interceptions
        description: "Projected interceptions (IDP)"

      - name: idp_fumbles_forced
        description: "Projected fumbles forced (IDP)"

      - name: idp_fumbles_recovered
        description: "Projected fumbles recovered (IDP)"

      - name: idp_touchdowns
        description: "Projected defensive touchdowns (IDP)"

    data_tests:
      - dbt_utils.unique_combination_of_columns:
          arguments:
            combination_of_columns:
              - player_id
              - season
              - week
              - horizon
              - asof_date
              - provider
