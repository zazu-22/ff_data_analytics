version: 2

models:
  - name: stg_ffanalytics__projections
    description: "Staged FFanalytics consensus projections with player ID mapping"
    columns:
      - name: player_id
        description: "Canonical player ID (sequential surrogate 1-N) mapped by R runner"
        data_tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_player_id_xref')
                field: player_id
      - name: season
        description: "NFL season year"
        data_tests:
          - not_null
          - accepted_values:
              arguments:
                values: [2020, 2021, 2022, 2023, 2024, 2025]
      - name: horizon
        description: "Projection timeframe"
        data_tests:
          - not_null
          - accepted_values:
              arguments:
                values: ["weekly", "full_season", "rest_of_season", "unknown"]
      - name: asof_date
        description: "When projection was made (UTC)"
        data_tests:
          - not_null
      - name: provider
        description: "Projection provider"
        data_tests:
          - not_null
          - accepted_values:
              arguments:
                values: ["ffanalytics_consensus"]
      - name: current_team
        description: "Canonical team code from dim_player_id_xref (fallback to consensus label if unavailable)"
      - name: team_consensus
        description: "Weighted consensus team label prior to crosswalk normalization (for QA)"
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          arguments:
            combination_of_columns:
              - player_id
              - season
              - week
              - horizon
              - asof_date
              - provider
