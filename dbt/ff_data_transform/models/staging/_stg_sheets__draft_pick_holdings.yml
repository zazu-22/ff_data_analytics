version: 2

models:
  - name: stg_sheets__draft_pick_holdings
    description: >
      Normalized commissioner draft pick holdings with franchise identifiers,
      pick classifications (original, acquired, compensatory, trade_out),
      and current holding flags that exclude outbound trades and unresolved contingencies.
    columns:
      - name: snapshot_date
        data_tests:
          - not_null
      - name: year
        data_tests:
          - not_null
      - name: round
        data_tests:
          - not_null
          - accepted_values:
              arguments:
                values: [1, 2, 3, 4, 5]
      - name: gm_full_name
        data_tests:
          - not_null
      - name: franchise_id
        description: Franchise that currently owns the GM tab in the commissioner sheet.
        data_tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_franchise')
                field: franchise_id
      - name: pick_category
        data_tests:
          - not_null
          - accepted_values:
              arguments:
                values: ['original', 'acquired', 'compensatory', 'trade_out']
      - name: is_current_holding
        data_tests:
          - not_null
      - name: is_comp_pick
        data_tests:
          - not_null
      - name: is_pending
        data_tests:
          - not_null
      - name: source_type
        data_tests:
          - not_null
      - name: acquisition_note
        description: Raw commissioner text describing the acquisition (original owner or comp note).
      - name: acquisition_owner_key
        description: Normalized owner key derived from acquisition_note for cross-table joins.
      - name: trade_recipient
        description: Counterparty GM for outbound trades (if applicable).
      - name: trade_recipient_key
        description: Normalized owner key for the trade recipient (first/last name key).
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          arguments:
            combination_of_columns:
              - snapshot_date
              - gm_full_name
              - year
              - round
              - source_type
              - coalesce(acquisition_note, '')
