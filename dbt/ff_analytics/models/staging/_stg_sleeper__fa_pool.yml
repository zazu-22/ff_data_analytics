version: 2

models:
  - name: stg_sleeper__fa_pool
    description: |
      Free agent pool with player identity mapping.

      Grain: player_key, asof_date
      Source: Sleeper API (calculated FA pool)

      Key transformations:
      - Map sleeper_id â†’ canonical player_id via dim_player_id_xref (with provider fallbacks)
      - Filter to fantasy-relevant positions
      - Add player_key composite identifier

    columns:
      - name: player_key
        description: "Identity column (canonical player_id when mapped; provider fallback otherwise)"
        data_tests:
          - not_null

      - name: player_id
        description: "Canonical player identifier (dim_player_id_xref)"

      - name: mfl_id
        description: "Provider-specific MFL ID (if present)"
        data_tests:
          - relationships:
              arguments:
                to: ref('dim_player_id_xref')
                field: mfl_id
              config:
                where: "mfl_id IS NOT NULL"

      - name: sleeper_player_id
        description: Sleeper player ID (raw)
        data_tests:
          - not_null

      - name: player_name
        description: Player full name
        data_tests:
          - not_null

      - name: position
        description: Player position
        data_tests:
          - not_null
          - accepted_values:
              arguments:
                values: ['QB', 'RB', 'WR', 'TE', 'K', 'PK', 'DL', 'LB', 'DB', 'DEF', 'S', 'CB', 'DE', 'DT']

      - name: nfl_team
        description: Current NFL team

      - name: nfl_status
        description: NFL roster status
        data_tests:
          - accepted_values:
              arguments:
                values: ['Active', 'Injured Reserve', 'Questionable', 'Doubtful', 'Out', 'PUP']

      - name: is_mapped_to_dim_player
        description: Flag indicating if player mapped to canonical player_id
        data_tests:
          - not_null
          - accepted_values:
              arguments:
                values: [true, false]
