version: 2

models:
  - name: dim_player_id_xref
    description: |
      Player ID crosswalk - backward compatibility model for dim_player_id_xref.
      
      This model provides backward compatibility for all models that reference
      dim_player_id_xref via ref('dim_player_id_xref'). It is a passthrough wrapper
      around the staging model stg_nflverse__ff_playerids, which performs comprehensive
      deduplication logic.
      
      **Source**: stg_nflverse__ff_playerids (staging model with deduplication logic)
      **Migration**: Previously a seed (CSV), now a staging model for always-fresh data
      **Migration date**: 2025-11-06
      
      **Architecture**: Per ADR-011, uses sequential surrogate key (player_id 1-N) as
      primary key, with mfl_id retained as an attribute for cross-platform integration.
      
      **Grain**: One row per player (after filtering and deduplication)
      **Used by**: All core and staging models for player ID mapping and cross-platform integration

    config:
      materialized: table

    columns:
      - name: player_id
        description: |
          Canonical, sequential surrogate key (1-N) assigned deterministically.
          Primary key per ADR-011 (sequential surrogate key architecture).
          Ordering: mfl_id, gsis_id, name (ensures stability across runs).
          
          This is the canonical player identifier used throughout the pipeline for joins
          and foreign key relationships. mfl_id remains available as an attribute for
          external provider integration.
        data_tests:
          - not_null
          - unique

      - name: mfl_id
        description: |
          MyFantasyLeague player ID (external ID from nflverse).
          Used for cross-platform integration and external provider mapping.
          Sentinel value -1 indicates ID was cleared due to duplicate (player record preserved).
        data_tests:
          - not_null

      - name: gsis_id
        description: |
          NFL GSIS ID.
          Used for mapping to nflverse player_stats and other NFL official data sources.
          Sentinel value 'DUPLICATE_CLEARED' indicates ID was cleared due to duplicate (player record preserved).

      - name: sleeper_id
        description: |
          Sleeper platform player ID.
          Used for mapping to Sleeper API data (rosters, free agents, etc.).
          Sentinel value -1 indicates ID was cleared due to duplicate (player record preserved).

      - name: espn_id
        description: ESPN player ID

      - name: yahoo_id
        description: Yahoo Fantasy player ID

      - name: pfr_id
        description: Pro Football Reference player ID

      - name: fantasypros_id
        description: FantasyPros player ID

      - name: pff_id
        description: Pro Football Focus player ID

      - name: cbs_id
        description: CBS Sports player ID

      - name: ktc_id
        description: KeepTradeCut player ID

      - name: sportradar_id
        description: Sportradar player ID

      - name: fleaflicker_id
        description: Fleaflicker player ID

      - name: rotowire_id
        description: Rotowire player ID

      - name: rotoworld_id
        description: Rotoworld player ID

      - name: stats_id
        description: Stats.com player ID

      - name: stats_global_id
        description: Stats Global player ID

      - name: fantasy_data_id
        description: FantasyData player ID

      - name: swish_id
        description: Swish Analytics player ID

      - name: cfbref_id
        description: College Football Reference player ID

      - name: nfl_id
        description: NFL.com player ID

      - name: name
        description: |
          Player name in "First Last" format.
          Primary display name for player identification.
        data_tests:
          - not_null

      - name: merge_name
        description: |
          Normalized name for fuzzy matching (lowercased, normalized).
          Used for name-based player matching in commissioner sheets and other sources
          where exact name matching may fail.

      - name: name_last_first
        description: |
          Player name in "Last, First" format for FantasySharks projection matching.
          Generated from name field (e.g., "Patrick Mahomes" â†’ "Mahomes, Patrick").
          Used for crosswalking projection data that uses last-first name format.

      - name: position
        description: |
          Player position (QB, RB, WR, TE, DE, DT, CB, S, etc.).
          NFL-specific position codes used for filtering and grouping.

      - name: team
        description: |
          Current NFL team abbreviation.
          Null for unsigned free agents.

      - name: birthdate
        description: |
          Player birthdate (used for duplicate resolution).
          Used during deduplication to validate sleeper_id mappings via Sleeper API.

      - name: draft_year
        description: |
          NFL draft year (used for duplicate resolution, null for undrafted).
          Used during deduplication to resolve gsis_id and mfl_id duplicates
          (keeps player with higher draft_year).

      - name: xref_correction_status
        description: |
          Correction status tracking for duplicate resolution.
          
          Values:
          - 'original': No corrections applied
          - 'cleared_sleeper_duplicate': sleeper_id cleared due to birthdate mismatch
          - 'kept_sleeper_verified': sleeper_id kept after birthdate verification
          - 'cleared_gsis_duplicate': gsis_id cleared (older player in duplicate set)
          - 'kept_gsis_newer': gsis_id kept (newer player in duplicate set)
          - 'cleared_mfl_duplicate': mfl_id cleared (older player in duplicate set)
          - 'kept_mfl_newer': mfl_id kept (newer player in duplicate set)
          
          This field enables observability into the deduplication process and helps
          identify data quality issues in source provider data.

