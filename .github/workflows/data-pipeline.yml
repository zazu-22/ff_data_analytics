name: data-pipeline

on:
  workflow_dispatch:
  schedule:
    - cron: "0 8 * * 1"   # Mondays 08:00 UTC for nflverse weekly
    - cron: "0 8 * * 2"   # Tuesdays 08:00 UTC for projections

jobs:
  nflverse:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      - name: Install Python deps with uv
        run: |
          pip install uv
          uv pip install polars pyarrow nflreadpy
      - name: Run nflverse shim (players, weekly)
        run: |
          python -c "from ingest.nflverse.shim import load_nflverse; print(load_nflverse('players'))"
          python -c "from ingest.nflverse.shim import load_nflverse; print(load_nflverse('weekly', seasons=[2023]))"

  projections:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: r-lib/actions/setup-r@v2
        with:
          r-version: '4.3.3'
      - name: Setup R packages
        run: |
          R -q -e "install.packages(c('jsonlite','optparse','yaml','arrow','lubridate'), repos='https://cloud.r-project.org')"
          R -q -e "remotes::install_github('FantasyFootballAnalytics/ffanalytics')"
          R -q -e "remotes::install_github('nflverse/nflreadr')"  # for completeness
      - name: Run ffanalytics projections (stub)
        run: |
          Rscript scripts/R/ffanalytics_run.R --config config/projections/ffanalytics_projections_config.yaml --scoring config/scoring/sleeper_scoring_rules.yaml
