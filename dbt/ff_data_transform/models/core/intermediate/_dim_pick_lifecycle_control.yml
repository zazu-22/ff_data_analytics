version: 2

models:
  - name: dim_pick_lifecycle_control
    description: |
      Pick Lifecycle Control - Manages TBD → Actual Pick Transitions.

      Grain: One row per pick with lifecycle tracking (primarily TBD picks)
      Source: int_pick_tbd

      Tracks lifecycle states of draft picks, especially TBD picks that transition
      to actual picks when draft order is finalized.

      Current State (P1-020 Fix):
      - TBD → Actual matching NOT YET IMPLEMENTED
      - All TBD picks remain in ACTIVE_TBD state indefinitely
      - superseded_by_pick_id and superseded_at are always NULL
      - Downstream models (dim_pick, int_pick_transaction_xref) handle NULL values correctly

      Implementation Needed:
      TBD → Actual matching requires franchise ownership tracking to avoid Cartesian products.
      Cannot match on (season, round) alone - would create duplicates (1 TBD × N actual picks).
      Need to determine which franchise owned the TBD pick and match to their specific actual pick.

      Lifecycle States:
      - ACTIVE_TBD: TBD pick currently in use (draft order not finalized) [ALL PICKS CURRENTLY]
      - SUPERSEDED: TBD pick replaced by actual pick (soft-delete) [NOT IMPLEMENTED YET]
      - ACTUAL: Pick from actual draft data (future state) [NOT IMPLEMENTED YET]

    columns:
      - name: pick_id
        description: "Pick identifier (includes both TBD and actual picks)"
        data_tests:
          - unique
          - not_null

      - name: lifecycle_state
        description: "Current lifecycle state (ACTIVE_TBD, SUPERSEDED, ACTUAL)"
        data_tests:
          - not_null

      - name: superseded_by_pick_id
        description: "Pick ID that replaced this TBD pick (always NULL - TBD matching not implemented)"

      - name: superseded_at
        description: "Timestamp when TBD pick was replaced by actual pick (always NULL - TBD matching not implemented)"

      - name: season
        description: "Draft year"

      - name: round
        description: "Draft round number"

      - name: created_at
        description: "Timestamp when this lifecycle record was created"

      - name: migration_note
        description: "Explanation of lifecycle migration or state change"

      - name: control_version
        description: "Version number for lifecycle control records"

      - name: last_updated
        description: "Timestamp when this record was last updated"
