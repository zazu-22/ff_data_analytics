version: 2

sources:
  - name: sleeper
    description: |
      Sleeper platform data loaded via production loader.

      Schedule: Daily refresh (6am/6pm EST via GitHub Actions)
      Loader: scripts/ingest/load_sleeper.py

      Future: Will migrate to BigQuery external tables pointing to GCS.

    tables:
      - name: rosters
        description: |
          Current roster ownership by team.

          Grain: roster_id (one row per team)
          Refresh: Daily

        external_location: "data/raw/sleeper/rosters/dt=*/rosters_*.parquet"

        columns:
          - name: roster_id
            description: Sleeper roster ID (unique per team)
          - name: owner_id
            description: Sleeper user ID (owner)
          - name: players
            description: Array of sleeper_player_ids on roster
          - name: starters
            description: Array of sleeper_player_ids in starting lineup

      - name: players
        description: |
          Full NFL player database from Sleeper (~5MB).

          Grain: sleeper_player_id (one row per player)
          Refresh: Weekly (cached 1hr in loader)

          Usage: Used for crosswalk validation in dim_player_id_xref seed generation
          to resolve sleeper_id duplicates from nflverse ff_playerids.

        loaded_at_field: dt

        freshness:
          warn_after: {count: 30, period: day}
          error_after: {count: 60, period: day}

        external_location: "data/raw/sleeper/players/dt=*/players_*.parquet"

        columns:
          - name: sleeper_player_id
            description: Sleeper player ID (primary key)
          - name: full_name
            description: Player full name
          - name: position
            description: Player position (QB, RB, WR, TE, K, DEF, etc.)
          - name: team
            description: Current NFL team
          - name: status
            description: NFL roster status (Active, Injured Reserve, etc.)
          - name: birth_date
            description: Player birthdate (used for duplicate resolution in crosswalk)

      - name: fa_pool
        description: |
          Fantasy-relevant players from Sleeper API (filtered by position only).

          Grain: sleeper_player_id (one row per player)
          Refresh: Daily

          Note: This is a simplified extraction - filters to fantasy-relevant positions.
          Does NOT account for status or roster membership. For actual league FA pool,
          see stg_sleeper__fa_pool which applies additional filtering.

        external_location: "data/raw/sleeper/fa_pool/dt=*/fa_pool_*.parquet"

        columns:
          - name: sleeper_player_id
            description: Sleeper player ID
          - name: full_name
            description: Player full name
          - name: position
            description: Player position
          - name: team
            description: Current NFL team
          - name: status
            description: NFL roster status

      - name: users
        description: |
          League users/owners.

          Grain: user_id (one row per user)
          Refresh: Daily

        external_location: "data/raw/sleeper/users/dt=*/users_*.parquet"

        columns:
          - name: user_id
            description: Sleeper user ID
          - name: username
            description: Sleeper username
          - name: display_name
            description: Display name
